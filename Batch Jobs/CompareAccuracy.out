             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
           8967389      h100 Compare   hoan163  R       0:07      1 h100-04

group_by_length batching

[2025-04-11 17:10:47,961] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
Warning: The cache directory for DeepSpeed Triton autotune, /people/hoan163/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
Model:  openai-community/gpt2
LengthGroupedSampler with Smart Batching: False
ninja: no work to do.
Time to load fused_adam op: 6.059473752975464 seconds
[2025-04-11 17:11:10,819] [WARNING] [lr_schedules.py:855:get_lr] Attempting to get learning rate from scheduler before it has started

Training Begins

Indices Grouped

Epoch 0
Indices Grouped
Epoch 0 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 1.9862728118896484, 'eval_accuracy': 0.18141592920353983, 'eval_runtime': 2.7092, 'eval_samples_per_second': 166.837, 'eval_steps_per_second': 21.039, 'epoch': 1.0}
Evaluation complete

Epoch 1
Indices Grouped
Epoch 1 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 1.823684573173523, 'eval_accuracy': 0.2809734513274336, 'eval_runtime': 2.6037, 'eval_samples_per_second': 173.599, 'eval_steps_per_second': 21.892, 'epoch': 2.0}
Evaluation complete

Epoch 2
Indices Grouped
Epoch 2 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 1.404800534248352, 'eval_accuracy': 0.4314159292035398, 'eval_runtime': 2.5803, 'eval_samples_per_second': 175.176, 'eval_steps_per_second': 22.091, 'epoch': 3.0}
Evaluation complete

Epoch 3
Indices Grouped
Epoch 3 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 0.9930052161216736, 'eval_accuracy': 0.6482300884955752, 'eval_runtime': 2.5892, 'eval_samples_per_second': 174.573, 'eval_steps_per_second': 22.015, 'epoch': 4.0}
Evaluation complete

Epoch 4
Indices Grouped
Epoch 4 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 0.92548668384552, 'eval_accuracy': 0.6814159292035398, 'eval_runtime': 2.5816, 'eval_samples_per_second': 175.082, 'eval_steps_per_second': 22.079, 'epoch': 5.0}
Evaluation complete

Epoch 5
Indices Grouped
Epoch 5 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 1.0118341445922852, 'eval_accuracy': 0.7278761061946902, 'eval_runtime': 2.5952, 'eval_samples_per_second': 174.166, 'eval_steps_per_second': 21.963, 'epoch': 6.0}
Evaluation complete

Epoch 6
Indices Grouped
Epoch 6 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 0.893120527267456, 'eval_accuracy': 0.7300884955752213, 'eval_runtime': 2.5998, 'eval_samples_per_second': 173.862, 'eval_steps_per_second': 21.925, 'epoch': 7.0}
Evaluation complete

Epoch 7
Indices Grouped
Epoch 7 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 1.0397337675094604, 'eval_accuracy': 0.754424778761062, 'eval_runtime': 2.5968, 'eval_samples_per_second': 174.063, 'eval_steps_per_second': 21.95, 'epoch': 8.0}
Evaluation complete

Epoch 8
Indices Grouped
Epoch 8 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 1.1317304372787476, 'eval_accuracy': 0.7588495575221239, 'eval_runtime': 2.5994, 'eval_samples_per_second': 173.885, 'eval_steps_per_second': 21.928, 'epoch': 9.0}
Evaluation complete

Epoch 9
Indices Grouped
Epoch 9 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 1.0789034366607666, 'eval_accuracy': 0.7942477876106194, 'eval_runtime': 2.5989, 'eval_samples_per_second': 173.92, 'eval_steps_per_second': 21.932, 'epoch': 10.0}
Evaluation complete

Epoch 10
Indices Grouped
Epoch 10 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 1.2029718160629272, 'eval_accuracy': 0.7986725663716814, 'eval_runtime': 2.5998, 'eval_samples_per_second': 173.857, 'eval_steps_per_second': 21.924, 'epoch': 11.0}
Evaluation complete

Epoch 11
Indices Grouped
Epoch 11 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 1.3407827615737915, 'eval_accuracy': 0.7920353982300885, 'eval_runtime': 2.6106, 'eval_samples_per_second': 173.138, 'eval_steps_per_second': 21.834, 'epoch': 12.0}
Evaluation complete

Epoch 12
Indices Grouped
Epoch 12 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 1.4295177459716797, 'eval_accuracy': 0.8008849557522124, 'eval_runtime': 2.6037, 'eval_samples_per_second': 173.598, 'eval_steps_per_second': 21.892, 'epoch': 13.0}
Evaluation complete

Epoch 13
Indices Grouped
Epoch 13 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 1.3548251390457153, 'eval_accuracy': 0.7876106194690266, 'eval_runtime': 2.5854, 'eval_samples_per_second': 174.827, 'eval_steps_per_second': 22.047, 'epoch': 14.0}
Evaluation complete

Epoch 14
Indices Grouped
Epoch 14 Padding Metrics
Total number of zero padding vs real tokens: 32459 : 2804224
Percentage of zero padding in epoch: 1.1442589813525164%
Average number of zero padding per sequence: 8.983946858566288

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: False
Indices Grouped
{'eval_loss': 1.3596469163894653, 'eval_accuracy': 0.7964601769911505, 'eval_runtime': 2.6028, 'eval_samples_per_second': 173.659, 'eval_steps_per_second': 21.9, 'epoch': 15.0}
Evaluation complete
{'train_runtime': 947.2002, 'train_samples_per_second': 57.216, 'train_steps_per_second': 7.158, 'train_loss': 0.5842107992256638, 'epoch': 15.0}

Training Complete
Total Runtime: 947.1989375 seconds

Final Test
LengthGroupedSampler with Smart Batching: False
Indices Grouped
Evaluation complete
{'eval_loss': 1.4407587051391602, 'eval_accuracy': 0.8053097345132744, 'eval_runtime': 2.6034, 'eval_samples_per_second': 173.617, 'eval_steps_per_second': 21.894, 'epoch': 15.0}


no_shuffle group_by_length batching 

[2025-04-11 17:27:31,656] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
Warning: The cache directory for DeepSpeed Triton autotune, /people/hoan163/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
Model:  openai-community/gpt2
LengthGroupedSampler with Smart Batching: True
ninja: no work to do.
Time to load fused_adam op: 5.4484148025512695 seconds
[2025-04-11 17:27:42,776] [WARNING] [lr_schedules.py:855:get_lr] Attempting to get learning rate from scheduler before it has started

Training Begins

Indices Grouped

Epoch 0
Indices Grouped
Epoch 0 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 1.3276094198226929, 'eval_accuracy': 0.6150442477876106, 'eval_runtime': 2.5974, 'eval_samples_per_second': 174.021, 'eval_steps_per_second': 21.945, 'epoch': 1.0}
Evaluation complete

Epoch 1
Indices Grouped
Epoch 1 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.9438876509666443, 'eval_accuracy': 0.745575221238938, 'eval_runtime': 2.5171, 'eval_samples_per_second': 179.575, 'eval_steps_per_second': 22.645, 'epoch': 2.0}
Evaluation complete

Epoch 2
Indices Grouped
Epoch 2 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.8277540802955627, 'eval_accuracy': 0.7721238938053098, 'eval_runtime': 2.5301, 'eval_samples_per_second': 178.651, 'eval_steps_per_second': 22.529, 'epoch': 3.0}
Evaluation complete

Epoch 3
Indices Grouped
Epoch 3 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.6272435784339905, 'eval_accuracy': 0.8141592920353983, 'eval_runtime': 2.5334, 'eval_samples_per_second': 178.418, 'eval_steps_per_second': 22.5, 'epoch': 4.0}
Evaluation complete

Epoch 4
Indices Grouped
Epoch 4 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.6198331713676453, 'eval_accuracy': 0.8207964601769911, 'eval_runtime': 2.6042, 'eval_samples_per_second': 173.565, 'eval_steps_per_second': 21.888, 'epoch': 5.0}
Evaluation complete

Epoch 5
Indices Grouped
Epoch 5 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.7602618932723999, 'eval_accuracy': 0.827433628318584, 'eval_runtime': 2.5315, 'eval_samples_per_second': 178.549, 'eval_steps_per_second': 22.516, 'epoch': 6.0}
Evaluation complete

Epoch 6
Indices Grouped
Epoch 6 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.6567774415016174, 'eval_accuracy': 0.8561946902654868, 'eval_runtime': 2.5297, 'eval_samples_per_second': 178.677, 'eval_steps_per_second': 22.532, 'epoch': 7.0}
Evaluation complete

Epoch 7
Indices Grouped
Epoch 7 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.5251928567886353, 'eval_accuracy': 0.8982300884955752, 'eval_runtime': 2.5589, 'eval_samples_per_second': 176.64, 'eval_steps_per_second': 22.275, 'epoch': 8.0}
Evaluation complete

Epoch 8
Indices Grouped
Epoch 8 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.590357780456543, 'eval_accuracy': 0.8960176991150443, 'eval_runtime': 2.5309, 'eval_samples_per_second': 178.593, 'eval_steps_per_second': 22.522, 'epoch': 9.0}
Evaluation complete

Epoch 9
Indices Grouped
Epoch 9 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.4900800585746765, 'eval_accuracy': 0.9004424778761062, 'eval_runtime': 2.53, 'eval_samples_per_second': 178.656, 'eval_steps_per_second': 22.53, 'epoch': 10.0}
Evaluation complete

Epoch 10
Indices Grouped
Epoch 10 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.45460253953933716, 'eval_accuracy': 0.911504424778761, 'eval_runtime': 2.5252, 'eval_samples_per_second': 178.998, 'eval_steps_per_second': 22.573, 'epoch': 11.0}
Evaluation complete

Epoch 11
Indices Grouped
Epoch 11 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.46848803758621216, 'eval_accuracy': 0.9026548672566371, 'eval_runtime': 2.5277, 'eval_samples_per_second': 178.815, 'eval_steps_per_second': 22.55, 'epoch': 12.0}
Evaluation complete

Epoch 12
Indices Grouped
Epoch 12 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.4763701558113098, 'eval_accuracy': 0.8982300884955752, 'eval_runtime': 2.5236, 'eval_samples_per_second': 179.108, 'eval_steps_per_second': 22.587, 'epoch': 13.0}
Evaluation complete

Epoch 13
Indices Grouped
Epoch 13 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.4803919792175293, 'eval_accuracy': 0.8960176991150443, 'eval_runtime': 2.5262, 'eval_samples_per_second': 178.922, 'eval_steps_per_second': 22.563, 'epoch': 14.0}
Evaluation complete

Epoch 14
Indices Grouped
Epoch 14 Padding Metrics
Total number of zero padding vs real tokens: 3403 : 2804224
Percentage of zero padding in epoch: 0.12120555900053676%
Average number of zero padding per sequence: 0.9418765568779408

Begin evaluation and logging for current epoch
LengthGroupedSampler with Smart Batching: True
Indices Grouped
{'eval_loss': 0.48199737071990967, 'eval_accuracy': 0.8982300884955752, 'eval_runtime': 2.5429, 'eval_samples_per_second': 177.748, 'eval_steps_per_second': 22.415, 'epoch': 15.0}
Evaluation complete
{'train_runtime': 928.2157, 'train_samples_per_second': 58.386, 'train_steps_per_second': 7.304, 'train_loss': 0.2558749488673027, 'epoch': 15.0}

Training Complete
Total Runtime: 928.214 seconds

Final Test
LengthGroupedSampler with Smart Batching: True
Indices Grouped
Evaluation complete
{'eval_loss': 0.4807468056678772, 'eval_accuracy': 0.9092920353982301, 'eval_runtime': 2.5353, 'eval_samples_per_second': 178.281, 'eval_steps_per_second': 22.482, 'epoch': 15.0}
